---
title Project-Course-2
author Gustavo I. Camilo
date 11102019
output html_document
---

```{r}
require(tidyverse)
require(dplyr)
require(pacman)
require(ggplot2)
pacman::p_load(plyr, dplyr, tidyr)
pacman::p_load(readr, haven, ggplot2, Hmisc)
pacman::p_load(knitr,stargazer)

```


```{r}

StormData <- tbl_df(read.csv(file.choose(), header = T, sep = ,))

```

## 1- Across the United States, which types of events (as indicated in the 'EVTYPE' variable) are most harmful with respect to population health?



```{r}
StormData.fatalities <- StormData %>% select(EVTYPE, FATALITIES) %>% group_by(EVTYPE) %>% summarise(total.fatalities = sum(FATALITIES)) %>% arrange(-total.fatalities)
head(StormData.fatalities, n=10)
```

```{r}
StormData.injuries <- StormData %>% select(EVTYPE, INJURIES) %>% group_by(EVTYPE) %>% summarise(total.injuries = sum(INJURIES)) %>% arrange(-total.injuries)
```
## 2- Across the United States, which types of events have the greatest economic consequences?

```{r}
##Verificando quais limpezas precisamos fazer na coluna 'PROPDMGEXP' indentificado através do levels
head(StormData$PROPDMGEXP)

##Verificando quais limpezas precisamos fazer na coluna 'PROPDMGEXP' indentificado através do levels
head(StormData$CROPDMGEXP)
```
```{r}
##Limpando os dados das tabelas verificadas

StormData <-  StormData %>% mutate_at(vars(PROPDMGEXP,CROPDMGEXP), 
               funs(as.numeric(recode(.,'0'=1,'1'=10,'2'=10^2,'3'=10^3,'4'=10^4,'5'=10^5,
                                             '6'=10^6,'7'=10^7,'8'=10^8, 'B'=10^9,
                                             'h'=1^2,'H'=1^2, 'k'=10^3,'K'=10^3,'m'=10^6,'M'=10^6,
                                             ' '=0,'-'=0,'?'=0,'+'=0))))                            


```


```{r}

PROPDMG <- StormData$PROPDMG * StormData$PROPDMGEXP
CROPDMG <- StormData$CROPDMG * StormData$CROPDMGEXP

StormData$TotalPropCrop <- PROPDMG + CROPDMG

EUA_economic <- aggregate(StormData$TotalPropCrop, by = list(StormData$EVTYPE), FUN = sum) 

colnames(EUA_economic) <- c("EVTYPE", "TOTALDMG")

EUA_economic <- StormData[order(EUA_economic$TOTALDMG, decreasing = TRUE),]

head(EUA_economic , n = 10)
```

